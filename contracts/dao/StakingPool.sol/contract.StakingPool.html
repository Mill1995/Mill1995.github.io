<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>StakingPool</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../book.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../../index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">contracts</li><li class="chapter-item expanded "><a href="../../../contracts/dao/index.html">❱ dao</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../contracts/dao/FactoryFilmNFT.sol/contract.FactoryFilmNFT.html">FactoryFilmNFT</a></li><li class="chapter-item "><a href="../../../contracts/dao/FactorySubNFT.sol/contract.FactorySubNFT.html">FactorySubNFT</a></li><li class="chapter-item "><a href="../../../contracts/dao/FactoryTierNFT.sol/contract.FactoryTierNFT.html">FactoryTierNFT</a></li><li class="chapter-item "><a href="../../../contracts/dao/Ownablee.sol/contract.Ownablee.html">Ownablee</a></li><li class="chapter-item "><a href="../../../contracts/dao/Property.sol/contract.Property.html">Property</a></li><li class="chapter-item expanded "><a href="../../../contracts/dao/StakingPool.sol/contract.StakingPool.html" class="active">StakingPool</a></li><li class="chapter-item "><a href="../../../contracts/dao/Subscription.sol/contract.Subscription.html">Subscription</a></li><li class="chapter-item "><a href="../../../contracts/dao/UniHelper.sol/contract.UniHelper.html">UniHelper</a></li><li class="chapter-item "><a href="../../../contracts/dao/VabbleDAO.sol/contract.VabbleDAO.html">VabbleDAO</a></li><li class="chapter-item "><a href="../../../contracts/dao/VabbleFund.sol/contract.VabbleFund.html">VabbleFund</a></li><li class="chapter-item "><a href="../../../contracts/dao/VabbleNFT.sol/contract.VabbleNFT.html">VabbleNFT</a></li><li class="chapter-item "><a href="../../../contracts/dao/Vote.sol/contract.Vote.html">Vote</a></li></ol></li><li class="chapter-item "><a href="../../../contracts/interfaces/index.html">❱ interfaces</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../contracts/interfaces/IFactoryFilmNFT.sol/interface.IFactoryFilmNFT.html">IFactoryFilmNFT</a></li><li class="chapter-item "><a href="../../../contracts/interfaces/IOwnablee.sol/interface.IOwnablee.html">IOwnablee</a></li><li class="chapter-item "><a href="../../../contracts/interfaces/IProperty.sol/interface.IProperty.html">IProperty</a></li><li class="chapter-item "><a href="../../../contracts/interfaces/IStakingPool.sol/interface.IStakingPool.html">IStakingPool</a></li><li class="chapter-item "><a href="../../../contracts/interfaces/IUniHelper.sol/interface.IUniHelper.html">IUniHelper</a></li><li class="chapter-item "><a href="../../../contracts/interfaces/IUniswapV2Factory.sol/interface.IUniswapV2Factory.html">IUniswapV2Factory</a></li><li class="chapter-item "><a href="../../../contracts/interfaces/IUniswapV2Router.sol/interface.IUniswapV2Router.html">IUniswapV2Router</a></li><li class="chapter-item "><a href="../../../contracts/interfaces/IVabbleDAO.sol/interface.IVabbleDAO.html">IVabbleDAO</a></li><li class="chapter-item "><a href="../../../contracts/interfaces/IVabbleFund.sol/interface.IVabbleFund.html">IVabbleFund</a></li><li class="chapter-item "><a href="../../../contracts/interfaces/IVote.sol/interface.IVote.html">IVote</a></li></ol></li><li class="chapter-item "><a href="../../../contracts/libraries/index.html">❱ libraries</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../contracts/libraries/Arrays.sol/library.Arrays.html">Arrays</a></li><li class="chapter-item "><a href="../../../contracts/libraries/Helper.sol/library.Helper.html">Helper</a></li></ol></li><li class="chapter-item "><a href="../../../contracts/mocks/index.html">❱ mocks</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../contracts/mocks/MockERC1155.sol/contract.MockERC1155.html">MockERC1155</a></li><li class="chapter-item "><a href="../../../contracts/mocks/MockERC20.sol/contract.MockERC20.html">MockERC20</a></li><li class="chapter-item "><a href="../../../contracts/mocks/MockERC721.sol/contract.MockERC721.html">MockERC721</a></li><li class="chapter-item "><a href="../../../contracts/mocks/MockUSDC.sol/contract.MockUSDC.html">MockUSDC</a></li><li class="chapter-item "><a href="../../../contracts/mocks/MockUSDT.sol/contract.MockUSDT.html">MockUSDT</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Mill1995/VABDAO" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="stakingpool"><a class="header" href="#stakingpool">StakingPool</a></h1>
<p><a href="https://github.com/Mill1995/VABDAO/blob/4914bdc306cbdb860037485ce4bcebbfdd390c9f/contracts/dao/StakingPool.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
ReentrancyGuard</p>
<p>This contract manages a staking pool where users can stake VAB tokens to earn rewards based on their staked
amount and participation in governance activities.
The contract handles staking, unstaking, calculating rewards, and distributing rewards to stakers.
It also facilitates  participation in governance by allowing stakers to vote on proposals and earn rewards based on
their voting activities.
Stakers can:</p>
<ul>
<li>Stake VAB tokens to participate in the staking pool.</li>
<li>Earn rewards based on the amount staked and their participation in governance activities such as voting on
proposals.</li>
<li>Unstake their tokens after a lock period to withdraw their staked amount and any earned rewards.</li>
<li>Vote on proposals submitted to the governance system, this includes governance and film proposals.
The contract calculates rewards based on the staking period, the amount staked, and the user's participation in
governance.
During a migration process, stakers can withdraw their staked tokens and any accrued rewards without earning new
rewards until the migration is complete.
The contract ensures that stakers can safely withdraw their funds during this period
while maintaining the integrity of the staking pool and ongoing governance activities.
Stakers are informed about the migration status, allowing them to make informed decisions regarding their staked
amounts and participation in governance activities.
This contract plays a critical role in the Vabble ecosystem by providing a secure and efficient platform for staking
VAB tokens for participating in governance decisions and earning rewards.</li>
</ul>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="ownable"><a class="header" href="#ownable">OWNABLE</a></h3>
<p><em>The Ownablee contract address</em></p>
<pre><code class="language-solidity">address private immutable OWNABLE;
</code></pre>
<h3 id="vote"><a class="header" href="#vote">VOTE</a></h3>
<p><em>The Vote contract address</em></p>
<pre><code class="language-solidity">address private VOTE;
</code></pre>
<h3 id="vabble_dao"><a class="header" href="#vabble_dao">VABBLE_DAO</a></h3>
<p><em>The VabbleDAO contract address</em></p>
<pre><code class="language-solidity">address private VABBLE_DAO;
</code></pre>
<h3 id="dao_property"><a class="header" href="#dao_property">DAO_PROPERTY</a></h3>
<p><em>The Property contract address</em></p>
<pre><code class="language-solidity">address private DAO_PROPERTY;
</code></pre>
<h3 id="totalstakingamount"><a class="header" href="#totalstakingamount">totalStakingAmount</a></h3>
<p>Total amount staked in the contract</p>
<pre><code class="language-solidity">uint256 public totalStakingAmount;
</code></pre>
<h3 id="totalrewardamount"><a class="header" href="#totalrewardamount">totalRewardAmount</a></h3>
<p>Total amount of rewards available for distribution</p>
<pre><code class="language-solidity">uint256 public totalRewardAmount;
</code></pre>
<h3 id="totalrewardissuedamount"><a class="header" href="#totalrewardissuedamount">totalRewardIssuedAmount</a></h3>
<p>Total amount of rewards already distributed</p>
<pre><code class="language-solidity">uint256 public totalRewardIssuedAmount;
</code></pre>
<h3 id="lastfundproposalcreatetime"><a class="header" href="#lastfundproposalcreatetime">lastfundProposalCreateTime</a></h3>
<p>Timestamp of the last funding proposal creation on the VabbleDAO contract</p>
<pre><code class="language-solidity">uint256 public lastfundProposalCreateTime;
</code></pre>
<h3 id="migrationstatus"><a class="header" href="#migrationstatus">migrationStatus</a></h3>
<p>Migration status of the contract:</p>
<ul>
<li>0: not started</li>
<li>1: started</li>
<li>2: ended</li>
</ul>
<pre><code class="language-solidity">uint256 public migrationStatus = 0;
</code></pre>
<h3 id="totalmigrationvab"><a class="header" href="#totalmigrationvab">totalMigrationVAB</a></h3>
<p>Total amount of tokens that can be migrated</p>
<pre><code class="language-solidity">uint256 public totalMigrationVAB = 0;
</code></pre>
<h3 id="votedtime"><a class="header" href="#votedtime">votedTime</a></h3>
<p><em>Mapping to track the time of votes for proposals
(user, proposalID) =&gt; voteTime needed for calculating rewards</em></p>
<pre><code class="language-solidity">mapping(address =&gt; mapping(uint256 =&gt; uint256)) private votedTime;
</code></pre>
<h3 id="stakeinfo"><a class="header" href="#stakeinfo">stakeInfo</a></h3>
<p>Mapping to store stake information for each address</p>
<pre><code class="language-solidity">mapping(address =&gt; Stake) public stakeInfo;
</code></pre>
<h3 id="receivedrewardamount"><a class="header" href="#receivedrewardamount">receivedRewardAmount</a></h3>
<p>Mapping to track the amount of rewards received by each staker</p>
<pre><code class="language-solidity">mapping(address =&gt; uint256) public receivedRewardAmount;
</code></pre>
<h3 id="userrentinfo"><a class="header" href="#userrentinfo">userRentInfo</a></h3>
<p>Mapping to store rental information for each user</p>
<pre><code class="language-solidity">mapping(address =&gt; UserRent) public userRentInfo;
</code></pre>
<h3 id="minproposalindex"><a class="header" href="#minproposalindex">minProposalIndex</a></h3>
<p>Mapping to track the minimum proposal index for each address</p>
<pre><code class="language-solidity">mapping(address =&gt; uint256) public minProposalIndex;
</code></pre>
<h3 id="proposalcount"><a class="header" href="#proposalcount">proposalCount</a></h3>
<p>Counter to keep track of the number of proposals</p>
<p>Count starts from 1</p>
<pre><code class="language-solidity">Counters.Counter public proposalCount;
</code></pre>
<h3 id="stakermap"><a class="header" href="#stakermap">stakerMap</a></h3>
<p><em>Struct to store staker information</em></p>
<pre><code class="language-solidity">Staker private stakerMap;
</code></pre>
<h3 id="propslist"><a class="header" href="#propslist">propsList</a></h3>
<p><em>Array to store proposal information, needed for calculating rewards</em></p>
<pre><code class="language-solidity">Props[] private propsList;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="onlyvote"><a class="header" href="#onlyvote">onlyVote</a></h3>
<p><em>Restricts access to the Vote contract.</em></p>
<pre><code class="language-solidity">modifier onlyVote();
</code></pre>
<h3 id="onlydao"><a class="header" href="#onlydao">onlyDAO</a></h3>
<p><em>Restricts access to the VabbleDAO contract.</em></p>
<pre><code class="language-solidity">modifier onlyDAO();
</code></pre>
<h3 id="onlyauditor"><a class="header" href="#onlyauditor">onlyAuditor</a></h3>
<p><em>Restricts access to the current Auditor.</em></p>
<pre><code class="language-solidity">modifier onlyAuditor();
</code></pre>
<h3 id="onlydeployer"><a class="header" href="#onlydeployer">onlyDeployer</a></h3>
<p><em>Restricts access to the deployer of the Ownable contract.</em></p>
<pre><code class="language-solidity">modifier onlyDeployer();
</code></pre>
<h3 id="onlynormal"><a class="header" href="#onlynormal">onlyNormal</a></h3>
<p><em>Restricts access during migration.</em></p>
<pre><code class="language-solidity">modifier onlyNormal();
</code></pre>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p><em>Constructor function to initialize the StakingPool contract.</em></p>
<pre><code class="language-solidity">constructor(address _ownable);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_ownable</code></td><td><code>address</code></td><td>Address of the Ownable contract</td></tr>
</tbody></table>
</div>
<h3 id="initialize"><a class="header" href="#initialize">initialize</a></h3>
<p>Initializes the StakingPool contract, can only be called by the Deployer</p>
<pre><code class="language-solidity">function initialize(address _vabbleDAO, address _property, address _vote) external onlyDeployer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_vabbleDAO</code></td><td><code>address</code></td><td>Address of the VabbleDAO contract</td></tr>
<tr><td><code>_property</code></td><td><code>address</code></td><td>Address of the Property contract</td></tr>
<tr><td><code>_vote</code></td><td><code>address</code></td><td>Address of the Vote contract</td></tr>
</tbody></table>
</div>
<h3 id="addrewardtopool"><a class="header" href="#addrewardtopool">addRewardToPool</a></h3>
<p>Add reward token (VAB) to the StakingPool</p>
<p><em>Should be called before users start staking in order to generate staking rewards</em></p>
<p><em>This can't be called when a migration has started</em></p>
<pre><code class="language-solidity">function addRewardToPool(uint256 _amount) external onlyNormal nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>Amount of VAB tokens to add as reward</td></tr>
</tbody></table>
</div>
<h3 id="stakevab"><a class="header" href="#stakevab">stakeVAB</a></h3>
<p>Stake VAB token to the StakingPool to earn rewards and participate in the Governance</p>
<p><em>A user turns in to a staker when they stake their tokens</em></p>
<p><em>When a user stakes for the first time we add his address to the <code>stakerMap</code></em></p>
<p><em>This can't be called when a migration has started</em></p>
<pre><code class="language-solidity">function stakeVAB(uint256 _amount) external onlyNormal nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>Amount of VAB tokens to stake, must be greater than 1 Token</td></tr>
</tbody></table>
</div>
<h3 id="unstakevab"><a class="header" href="#unstakevab">unstakeVAB</a></h3>
<p>Unstake VAB tokens after the correct time period has elapsed or a migration has started.</p>
<p><em>The lock period of the tokens is a Governance property that can be changed through a proposal.</em></p>
<p><em>This will transfer the stake amount + realized rewards to the user.</em></p>
<p><em>This will remove the staker from the <code>stakerMap</code> when he unstakes all tokens.</em></p>
<pre><code class="language-solidity">function unstakeVAB(uint256 _amount) external nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>Amount of VAB tokens to unstake</td></tr>
</tbody></table>
</div>
<h3 id="withdrawreward"><a class="header" href="#withdrawreward">withdrawReward</a></h3>
<p>Withdraw Rewards without unstaking VAB tokens</p>
<p><em>This will lock the staked tokens for the duration of the lock period again</em></p>
<p><em>There must be rewards in the StakingPool to withdraw</em></p>
<pre><code class="language-solidity">function withdrawReward(uint256 _isCompound) external nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_isCompound</code></td><td><code>uint256</code></td><td>can either be 1 to compound rewards or 0 to withdraw the rewards</td></tr>
</tbody></table>
</div>
<h3 id="depositvab"><a class="header" href="#depositvab">depositVAB</a></h3>
<p>Users on the streaming portal need to deposit VAB used for renting films</p>
<p><em>This will update the userRentInfo for the given user.</em></p>
<p><em>This can't be called when a migration has started.</em></p>
<pre><code class="language-solidity">function depositVAB(uint256 _amount) external onlyNormal nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>Amount of VAB tokens to deposit</td></tr>
</tbody></table>
</div>
<h3 id="pendingwithdraw"><a class="header" href="#pendingwithdraw">pendingWithdraw</a></h3>
<p>Request a withdrawal of VAB tokens from the streaming portal</p>
<p><em>this is the counter part of the <code>depositVAB</code> function</em></p>
<p><em>users can only request one withdrawal at a time, then the Auditor needs to approve or deny the withdraw
request</em></p>
<pre><code class="language-solidity">function pendingWithdraw(uint256 _amount) external nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>Amount of VAB tokens to withdraw</td></tr>
</tbody></table>
</div>
<h3 id="approvependingwithdraw"><a class="header" href="#approvependingwithdraw">approvePendingWithdraw</a></h3>
<p>Approve pending withdrawals of given users by Auditor</p>
<p><em>A user has to call <code>pendingWithdraw</code> before</em></p>
<pre><code class="language-solidity">function approvePendingWithdraw(address[] calldata _customers) external onlyAuditor nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_customers</code></td><td><code>address[]</code></td><td>Array of user addresses</td></tr>
</tbody></table>
</div>
<h3 id="denypendingwithdraw"><a class="header" href="#denypendingwithdraw">denyPendingWithdraw</a></h3>
<p>Deny pending withdrawal of given users by Auditor</p>
<pre><code class="language-solidity">function denyPendingWithdraw(address[] calldata _customers) external onlyAuditor nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_customers</code></td><td><code>address[]</code></td><td>Array of user addresses</td></tr>
</tbody></table>
</div>
<h3 id="sendvab"><a class="header" href="#sendvab">sendVAB</a></h3>
<p>Send VAB tokens from the given users to the given address</p>
<p><em>This will be called from the VabbleDAO contract function <code>allocateToPool</code> by the Auditor</em></p>
<p><em>The Auditor calculates what a user has to pay</em></p>
<pre><code class="language-solidity">function sendVAB(
    address[] calldata _users,
    address _to,
    uint256[] calldata _amounts
)
    external
    onlyDAO
    returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_users</code></td><td><code>address[]</code></td><td>Array of user addresses</td></tr>
<tr><td><code>_to</code></td><td><code>address</code></td><td>Address to send tokens to</td></tr>
<tr><td><code>_amounts</code></td><td><code>uint256[]</code></td><td>Array of amounts to transfer</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>sum Total amount of VAB tokens transferred</td></tr>
</tbody></table>
</div>
<h3 id="calcmigrationvab"><a class="header" href="#calcmigrationvab">calcMigrationVAB</a></h3>
<p>Calculate VAB amount able to be migrated and for each staker to receive</p>
<p><em>This can only be called by the <code>Property::updateGovProposal()</code> function.</em></p>
<p><em>After a proposal to change the reward Address has passed Governance Voting, we calculate the total VAB we
can migrate to a new address. All users should receive their outstanding VAB rewards.</em></p>
<p><em>After calling this function the migrationStatus will be set to 1 and stakers wont receive any new rewards.</em></p>
<p><em>All stakers can immediately unstake their VAB.</em></p>
<pre><code class="language-solidity">function calcMigrationVAB() external onlyNormal nonReentrant;
</code></pre>
<h3 id="withdrawallfund"><a class="header" href="#withdrawallfund">withdrawAllFund</a></h3>
<p>Transfer all funds from the StakingPool, EdgePool and StudioPool to a new address</p>
<p><em>This will be called by the Auditor after a proposal to change the reward Address
<code>Property::proposalRewardFund()</code> has passed Governance Voting and has been finalized.</em></p>
<p><em>The <code>to</code> address is the address voted for by Governance.</em></p>
<p><em>This can only be called after <code>calcMigrationVAB</code>.</em></p>
<p><em>All VAB tokens will be transfered and the migration status will be updated to 2 (ended).</em></p>
<pre><code class="language-solidity">function withdrawAllFund() external onlyAuditor nonReentrant;
</code></pre>
<h3 id="addvoteddata"><a class="header" href="#addvoteddata">addVotedData</a></h3>
<p>Add voted data for a staker when they vote on (Governance / Film) proposals</p>
<p><em>We need this so we can track if a user has voted on a proposal in order to calculate rewards</em></p>
<pre><code class="language-solidity">function addVotedData(address _user, uint256 _time, uint256 _proposalID) external onlyVote;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>Address of the user</td></tr>
<tr><td><code>_time</code></td><td><code>uint256</code></td><td>Time of the vote</td></tr>
<tr><td><code>_proposalID</code></td><td><code>uint256</code></td><td>ID of the proposal</td></tr>
</tbody></table>
</div>
<h3 id="updatelastfundproposalcreatetime"><a class="header" href="#updatelastfundproposalcreatetime">updateLastfundProposalCreateTime</a></h3>
<p>Update the last creation time of a film proposal that is for funding</p>
<pre><code class="language-solidity">function updateLastfundProposalCreateTime(uint256 _time) external onlyDAO;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_time</code></td><td><code>uint256</code></td><td>New creation time</td></tr>
</tbody></table>
</div>
<h3 id="addproposaldata"><a class="header" href="#addproposaldata">addProposalData</a></h3>
<p>Add proposal data used for calculating staking rewards</p>
<p><em>This must be called when a Governance / Film proposal is created</em></p>
<pre><code class="language-solidity">function addProposalData(address _creator, uint256 _cTime, uint256 _period) external returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_creator</code></td><td><code>address</code></td><td>Address of the proposal creator</td></tr>
<tr><td><code>_cTime</code></td><td><code>uint256</code></td><td>Creation time of the proposal</td></tr>
<tr><td><code>_period</code></td><td><code>uint256</code></td><td>Vote period of the proposal</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>proposalID ID of the new proposal</td></tr>
</tbody></table>
</div>
<h3 id="checkallocatetopool"><a class="header" href="#checkallocatetopool">checkAllocateToPool</a></h3>
<p>Function to validate if <code>sendVAB()</code> can be called with the given arguments</p>
<p><em>Should be called before <code>VabbleDAO::allocateToPool()</code> to ensure that the arguments are valid</em></p>
<pre><code class="language-solidity">function checkAllocateToPool(address[] calldata _users, uint256[] calldata _amounts) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_users</code></td><td><code>address[]</code></td><td>Array of user addresses</td></tr>
<tr><td><code>_amounts</code></td><td><code>uint256[]</code></td><td>Array of amounts to allocate</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>bool True if allocation is valid, otherwise false</td></tr>
</tbody></table>
</div>
<h3 id="checkdenypendingwithdraw"><a class="header" href="#checkdenypendingwithdraw">checkDenyPendingWithDraw</a></h3>
<p>Check if pending withdrawals can be denied</p>
<p><em>Should be called before <code>denyPendingWithdraw()</code></em></p>
<pre><code class="language-solidity">function checkDenyPendingWithDraw(address[] calldata _customers) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_customers</code></td><td><code>address[]</code></td><td>Array of user addresses</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>bool True if withdrawals can be denied, otherwise false</td></tr>
</tbody></table>
</div>
<h3 id="checkapprovependingwithdraw"><a class="header" href="#checkapprovependingwithdraw">checkApprovePendingWithdraw</a></h3>
<p>Check if pending withdrawals can be approved</p>
<p><em>Should be called before <code>approvePendingWithdraw()</code></em></p>
<pre><code class="language-solidity">function checkApprovePendingWithdraw(address[] calldata _customers) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_customers</code></td><td><code>address[]</code></td><td>Array of user addresses</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>bool True if withdrawals can be approved, otherwise false</td></tr>
</tbody></table>
</div>
<h3 id="calculateapr"><a class="header" href="#calculateapr">calculateAPR</a></h3>
<p>Calculate APR (Annual Percentage Rate) for staking/pending rewards</p>
<pre><code class="language-solidity">function calculateAPR(
    uint256 _period,
    uint256 _stakeAmount,
    uint256 _proposalCount,
    uint256 _voteCount,
    bool isBoardMember
)
    external
    view
    returns (uint256 amount_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_period</code></td><td><code>uint256</code></td><td>The staking period in days (e.g., 2 days, 32 days, 365 days)</td></tr>
<tr><td><code>_stakeAmount</code></td><td><code>uint256</code></td><td>The amount of VAB staked (e.g., 100 VAB)</td></tr>
<tr><td><code>_proposalCount</code></td><td><code>uint256</code></td><td>The number of proposals during the staking period</td></tr>
<tr><td><code>_voteCount</code></td><td><code>uint256</code></td><td>The number of votes cast by the staker during the staking period</td></tr>
<tr><td><code>isBoardMember</code></td><td><code>bool</code></td><td>Indicates whether the staker is a film board member</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The calculated APR amount for the specified staking period and conditions</td></tr>
</tbody></table>
</div>
<h3 id="getstakeamount"><a class="header" href="#getstakeamount">getStakeAmount</a></h3>
<p>Get VAB staking amount for an address</p>
<pre><code class="language-solidity">function getStakeAmount(address _user) external view returns (uint256 amount_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the user</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The staking amount of the user</td></tr>
</tbody></table>
</div>
<h3 id="getrentvabamount"><a class="header" href="#getrentvabamount">getRentVABAmount</a></h3>
<p>Get user rent VAB amoun</p>
<p><em>This is the amount that was deposited on the streaming portal used to rent films</em></p>
<pre><code class="language-solidity">function getRentVABAmount(address _user) external view returns (uint256 amount_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the user</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The VAB amount of the user</td></tr>
</tbody></table>
</div>
<h3 id="getlimitcount"><a class="header" href="#getlimitcount">getLimitCount</a></h3>
<p>Get minimum amount of stakers that needs to vote for a proposal to pass</p>
<p><em>This is a threshold for proposals in order to pass</em></p>
<pre><code class="language-solidity">function getLimitCount() external view returns (uint256 count_);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>count_</code></td><td><code>uint256</code></td><td>The count of stakers for voting</td></tr>
</tbody></table>
</div>
<h3 id="getwithdrawabletime"><a class="header" href="#getwithdrawabletime">getWithdrawableTime</a></h3>
<p>Get the time when a staker can withdraw / unstake his VAB</p>
<pre><code class="language-solidity">function getWithdrawableTime(address _user) external view returns (uint256 time_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the user</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>time_</code></td><td><code>uint256</code></td><td>The time when the user can withdraw their stake</td></tr>
</tbody></table>
</div>
<h3 id="getstakerlist"><a class="header" href="#getstakerlist">getStakerList</a></h3>
<p>Get the list of all stakers</p>
<pre><code class="language-solidity">function getStakerList() external view returns (address[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>An array of addresses representing all stakers</td></tr>
</tbody></table>
</div>
<h3 id="calcrewardamount"><a class="header" href="#calcrewardamount">calcRewardAmount</a></h3>
<p>Calculate the VAB reward amount for a user including previous rewards</p>
<p><em>When a migration has started returns the outstanding rewards and doesn't generate new rewards</em></p>
<pre><code class="language-solidity">function calcRewardAmount(address _user) public view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the user</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total reward amount for the user</td></tr>
</tbody></table>
</div>
<h3 id="__calcproposaltimeintervals"><a class="header" href="#__calcproposaltimeintervals">__calcProposalTimeIntervals</a></h3>
<p>Calculate the proposal time intervals for a user.
This function computes the start and end times of all proposals that overlap with the staking period of a user.
The resulting array includes the user's stake time, the start and end times of the relevant proposals, and the
current block timestamp.</p>
<p><em>The function retrieves proposals from the <code>propsList</code> array and checks if their end time is greater than or
equal to the user's stake time.
It constructs an array containing the user's stake time, the start and end times of the overlapping proposals,
and the current block timestamp.</em></p>
<pre><code class="language-solidity">function __calcProposalTimeIntervals(address _user) public view returns (uint256[] memory times_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the user for whom the proposal time intervals are calculated.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>times_</code></td><td><code>uint256[]</code></td><td>An array of timestamps representing the proposal time intervals. The array is sorted in ascending order and includes: - The user's stake time at index 0. - The start and end times of the overlapping proposals. - The current block timestamp as the last element.</td></tr>
</tbody></table>
</div>
<h3 id="__getproposalvotecount"><a class="header" href="#__getproposalvotecount">__getProposalVoteCount</a></h3>
<p>Get the count of proposals, votes, and pending votes within a specific time interval for a user.
This function calculates the number of proposals, the number of votes cast by the user, and the number of pending
votes within a specified time interval.</p>
<p><em>The function iterates through the <code>propsList</code> array starting from `minIndex,
and counts proposals whose creation time falls within the interval [_start, _end].
It also counts the number of votes cast by the user during this period and pending votes.</em></p>
<pre><code class="language-solidity">function __getProposalVoteCount(
    address _user,
    uint256 minIndex,
    uint256 _start,
    uint256 _end
)
    public
    view
    returns (uint256, uint256, uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the user for whom the vote count is calculated.</td></tr>
<tr><td><code>minIndex</code></td><td><code>uint256</code></td><td>The minimum index of the proposals to consider.</td></tr>
<tr><td><code>_start</code></td><td><code>uint256</code></td><td>The start time of the interval in which the votes are counted.</td></tr>
<tr><td><code>_end</code></td><td><code>uint256</code></td><td>The end time of the interval in which the votes are counted.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>pCount The total number of proposals within the interval.</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>vCount The number of votes cast by the user within the interval.</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>pendingVoteCount The number of pending votes within the interval.</td></tr>
</tbody></table>
</div>
<h3 id="calcrealizedrewards"><a class="header" href="#calcrealizedrewards">calcRealizedRewards</a></h3>
<p>Calculate the realized rewards for a user
This function calculates the realized rewards for a user based on the proposals they have voted on and the
intervals between proposals within the staking period.</p>
<pre><code class="language-solidity">function calcRealizedRewards(address _user) public view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the user for whom the realized rewards are being calculated.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>realizeReward The total realized rewards for the user.</td></tr>
</tbody></table>
</div>
<h3 id="calcpendingrewards"><a class="header" href="#calcpendingrewards">calcPendingRewards</a></h3>
<p>Calculate the pending rewards for a user
This function calculates the pending rewards for a user based on the proposals they are yet to vote on within the
specified intervals between proposals within the staking period.</p>
<pre><code class="language-solidity">function calcPendingRewards(address _user) public view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the user for whom the pending rewards are being calculated.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>pendingReward The total pending rewards for the user.</td></tr>
</tbody></table>
</div>
<h3 id="stakercount"><a class="header" href="#stakercount">stakerCount</a></h3>
<p>Get the count of stakers</p>
<pre><code class="language-solidity">function stakerCount() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total number of stakers</td></tr>
</tbody></table>
</div>
<h3 id="getownableaddress"><a class="header" href="#getownableaddress">getOwnableAddress</a></h3>
<p>Get the address of the Ownable contract</p>
<pre><code class="language-solidity">function getOwnableAddress() public view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The address of the Ownable contract</td></tr>
</tbody></table>
</div>
<h3 id="getvoteaddress"><a class="header" href="#getvoteaddress">getVoteAddress</a></h3>
<p>Get the address of the Vote contract</p>
<pre><code class="language-solidity">function getVoteAddress() public view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The address of the Vote contract</td></tr>
</tbody></table>
</div>
<h3 id="getvabbledaoaddress"><a class="header" href="#getvabbledaoaddress">getVabbleDaoAddress</a></h3>
<p>Get the address of the VabbleDAO contract</p>
<pre><code class="language-solidity">function getVabbleDaoAddress() public view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The address of the VabbleDAO contract</td></tr>
</tbody></table>
</div>
<h3 id="getpropertyaddress"><a class="header" href="#getpropertyaddress">getPropertyAddress</a></h3>
<p>Get the address of the Property contract</p>
<pre><code class="language-solidity">function getPropertyAddress() public view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The address of the Property contract</td></tr>
</tbody></table>
</div>
<h3 id="__withdrawreward"><a class="header" href="#__withdrawreward">__withdrawReward</a></h3>
<p><em>Transfer reward amount to the user and update relevant states
This function handles the transfer of the reward amount to the user, updates the total reward amount,
received reward amount, and the user's stake information. It also emits the RewardWithdraw event
and updates the minimum proposal index for the user.</em></p>
<pre><code class="language-solidity">function __withdrawReward(uint256 _amount) private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The amount of reward to be withdrawn</td></tr>
</tbody></table>
</div>
<h3 id="__updateminproposalindex"><a class="header" href="#__updateminproposalindex">__updateMinProposalIndex</a></h3>
<p><em>Update the minimum proposal index for a user
This function updates the minimum proposal index for a user by iterating through the proposals
and finding the first proposal whose end time is greater than or equal to the user's stake time.</em></p>
<pre><code class="language-solidity">function __updateMinProposalIndex(address _user) private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the user whose minimum proposal index is being updated</td></tr>
</tbody></table>
</div>
<h3 id="__stakerset"><a class="header" href="#__stakerset">__stakerSet</a></h3>
<p><em>Add a staker to the staker map
This function adds a staker to the staker map if they are not already present.</em></p>
<pre><code class="language-solidity">function __stakerSet(address key) private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>key</code></td><td><code>address</code></td><td>The address of the staker to be added</td></tr>
</tbody></table>
</div>
<h3 id="__stakerremove"><a class="header" href="#__stakerremove">__stakerRemove</a></h3>
<p><em>Remove a staker from the staker map
This function removes a staker from the staker map if they are present.</em></p>
<pre><code class="language-solidity">function __stakerRemove(address key) private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>key</code></td><td><code>address</code></td><td>The address of the staker to be removed</td></tr>
</tbody></table>
</div>
<h3 id="__transfervabwithdraw"><a class="header" href="#__transfervabwithdraw">__transferVABWithdraw</a></h3>
<p><em>Transfer VAB tokens to fulfill a user's withdrawal request on the streaming portal</em></p>
<pre><code class="language-solidity">function __transferVABWithdraw(address _to) private returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_to</code></td><td><code>address</code></td><td>The address of the user to whom the VAB tokens are being transferred</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>payAmount The amount of VAB tokens transferred to the user</td></tr>
</tbody></table>
</div>
<h3 id="__calcrewards"><a class="header" href="#__calcrewards">__calcRewards</a></h3>
<p><em>Calculate the rewards for a user within a specific time period
This function calculates the rewards for a user based on their stake amount and the time period specified.
If the user is a film board member, additional rewards are included.</em></p>
<pre><code class="language-solidity">function __calcRewards(address _user, uint256 startTime, uint256 endTime) private view returns (uint256 amount_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_user</code></td><td><code>address</code></td><td>The address of the user for whom the rewards are being calculated</td></tr>
<tr><td><code>startTime</code></td><td><code>uint256</code></td><td>The start time of the reward calculation period</td></tr>
<tr><td><code>endTime</code></td><td><code>uint256</code></td><td>The end time of the reward calculation period</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The calculated reward amount for the user</td></tr>
</tbody></table>
</div>
<h3 id="__rewardpercent"><a class="header" href="#__rewardpercent">__rewardPercent</a></h3>
<p><em>Calculate the reward percentage based on the staking amount
This function calculates the reward percentage for a user based on their staking amount
and the total staking amount.</em></p>
<pre><code class="language-solidity">function __rewardPercent(uint256 _stakingAmount) private view returns (uint256 percent_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_stakingAmount</code></td><td><code>uint256</code></td><td>The amount staked by the user</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>percent_</code></td><td><code>uint256</code></td><td>The calculated reward percentage for the user</td></tr>
</tbody></table>
</div>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="tokenstaked"><a class="header" href="#tokenstaked">TokenStaked</a></h3>
<p><em>Emitted when a staker stakes VAB tokens.</em></p>
<pre><code class="language-solidity">event TokenStaked(address indexed staker, uint256 stakeAmount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>staker</code></td><td><code>address</code></td><td>The address of the staker.</td></tr>
<tr><td><code>stakeAmount</code></td><td><code>uint256</code></td><td>The amount of VAB tokens staked.</td></tr>
</tbody></table>
</div>
<h3 id="tokenunstaked"><a class="header" href="#tokenunstaked">TokenUnstaked</a></h3>
<p><em>Emitted when a staker unstakes VAB tokens.</em></p>
<pre><code class="language-solidity">event TokenUnstaked(address indexed unstaker, uint256 unStakeAmount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>unstaker</code></td><td><code>address</code></td><td>The address of the staker.</td></tr>
<tr><td><code>unStakeAmount</code></td><td><code>uint256</code></td><td>The amount of VAB tokens unstaked.</td></tr>
</tbody></table>
</div>
<h3 id="rewardwithdraw"><a class="header" href="#rewardwithdraw">RewardWithdraw</a></h3>
<p><em>Emitted when a staker withdraws rewards.</em></p>
<pre><code class="language-solidity">event RewardWithdraw(address indexed staker, uint256 rewardAmount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>staker</code></td><td><code>address</code></td><td>The address of the staker.</td></tr>
<tr><td><code>rewardAmount</code></td><td><code>uint256</code></td><td>The amount of rewards withdrawn.</td></tr>
</tbody></table>
</div>
<h3 id="rewardcontinued"><a class="header" href="#rewardcontinued">RewardContinued</a></h3>
<p><em>Emitted when a staker continues to receive rewards, either by withdrawing or compounding.</em></p>
<pre><code class="language-solidity">event RewardContinued(address indexed staker, uint256 isCompound, uint256 rewardAmount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>staker</code></td><td><code>address</code></td><td>The address of the staker.</td></tr>
<tr><td><code>isCompound</code></td><td><code>uint256</code></td><td>Flag indicating if the rewards are compounded (1) or withdrawn (0).</td></tr>
<tr><td><code>rewardAmount</code></td><td><code>uint256</code></td><td>The amount of rewards continued.</td></tr>
</tbody></table>
</div>
<h3 id="allfundwithdraw"><a class="header" href="#allfundwithdraw">AllFundWithdraw</a></h3>
<p><em>Emitted when all funds are withdrawn from the contract.</em></p>
<pre><code class="language-solidity">event AllFundWithdraw(address to, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address where the funds are withdrawn to.</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The total amount of funds withdrawn.</td></tr>
</tbody></table>
</div>
<h3 id="rewardadded"><a class="header" href="#rewardadded">RewardAdded</a></h3>
<p><em>Emitted when reward tokens are added to the pool.</em></p>
<pre><code class="language-solidity">event RewardAdded(uint256 totalRewardAmount, uint256 rewardAmount, address indexed contributor);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>totalRewardAmount</code></td><td><code>uint256</code></td><td>The total reward amount after addition.</td></tr>
<tr><td><code>rewardAmount</code></td><td><code>uint256</code></td><td>The amount of rewards added.</td></tr>
<tr><td><code>contributor</code></td><td><code>address</code></td><td>The address of the contributor who added the rewards.</td></tr>
</tbody></table>
</div>
<h3 id="vabdeposited"><a class="header" href="#vabdeposited">VABDeposited</a></h3>
<p><em>Emitted when VAB tokens are deposited by a user.</em></p>
<pre><code class="language-solidity">event VABDeposited(address indexed customer, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>customer</code></td><td><code>address</code></td><td>The address of the user who deposited VAB tokens.</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of VAB tokens deposited.</td></tr>
</tbody></table>
</div>
<h3 id="withdrawpending"><a class="header" href="#withdrawpending">WithdrawPending</a></h3>
<p><em>Emitted when a pending withdrawal request is made by a user.</em></p>
<pre><code class="language-solidity">event WithdrawPending(address indexed customer, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>customer</code></td><td><code>address</code></td><td>The address of the user who made the pending withdrawal request.</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of VAB tokens requested for withdrawal.</td></tr>
</tbody></table>
</div>
<h3 id="pendingwithdrawapproved"><a class="header" href="#pendingwithdrawapproved">PendingWithdrawApproved</a></h3>
<p><em>Emitted when pending withdrawal requests are approved by the auditor.</em></p>
<pre><code class="language-solidity">event PendingWithdrawApproved(address[] customers, uint256[] withdrawAmounts);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>customers</code></td><td><code>address[]</code></td><td>An array of user addresses whose pending withdrawals are approved.</td></tr>
<tr><td><code>withdrawAmounts</code></td><td><code>uint256[]</code></td><td>An array of withdrawal amounts approved for each user.</td></tr>
</tbody></table>
</div>
<h3 id="pendingwithdrawdenied"><a class="header" href="#pendingwithdrawdenied">PendingWithdrawDenied</a></h3>
<p><em>Emitted when pending withdrawal requests are denied by the auditor.</em></p>
<pre><code class="language-solidity">event PendingWithdrawDenied(address[] customers);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>customers</code></td><td><code>address[]</code></td><td>An array of user addresses whose pending withdrawals are denied.</td></tr>
</tbody></table>
</div>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="staker"><a class="header" href="#staker">Staker</a></h3>
<p><em>Struct for storing staker information.</em></p>
<pre><code class="language-solidity">struct Staker {
    address[] keys;
    mapping(address =&gt; uint256) indexOf;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>keys</code></td><td><code>address[]</code></td><td>Array of staker addresses.</td></tr>
<tr><td><code>indexOf</code></td><td><code>mapping(address =&gt; uint256)</code></td><td>Mapping of staker addresses to their index in the keys array.</td></tr>
</tbody></table>
</div>
<h3 id="stake"><a class="header" href="#stake">Stake</a></h3>
<p><em>Struct for storing staking information.</em></p>
<pre><code class="language-solidity">struct Stake {
    uint256 stakeAmount;
    uint256 stakeTime;
    uint256 outstandingReward;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>stakeAmount</code></td><td><code>uint256</code></td><td>The amount of VAB tokens staked.</td></tr>
<tr><td><code>stakeTime</code></td><td><code>uint256</code></td><td>The timestamp when the stake was made.</td></tr>
<tr><td><code>outstandingReward</code></td><td><code>uint256</code></td><td>The amount of outstanding rewards for the staker reserved after migration has started</td></tr>
</tbody></table>
</div>
<h3 id="userrent"><a class="header" href="#userrent">UserRent</a></h3>
<p><em>Struct for storing user rent information from the streaming portal.</em></p>
<pre><code class="language-solidity">struct UserRent {
    uint256 vabAmount;
    uint256 withdrawAmount;
    bool pending;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vabAmount</code></td><td><code>uint256</code></td><td>The amount of VAB tokens deposited by the user.</td></tr>
<tr><td><code>withdrawAmount</code></td><td><code>uint256</code></td><td>The amount of VAB tokens requested for withdrawal by the user.</td></tr>
<tr><td><code>pending</code></td><td><code>bool</code></td><td>Flag indicating if there's a pending withdrawal request for the user.</td></tr>
</tbody></table>
</div>
<h3 id="props"><a class="header" href="#props">Props</a></h3>
<p><em>Struct for storing proposal information.</em></p>
<pre><code class="language-solidity">struct Props {
    address creator;
    uint256 cTime;
    uint256 period;
    uint256 proposalID;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>creator</code></td><td><code>address</code></td><td>The address of the proposal creator.</td></tr>
<tr><td><code>cTime</code></td><td><code>uint256</code></td><td>The creation time of the proposal.</td></tr>
<tr><td><code>period</code></td><td><code>uint256</code></td><td>The duration of the proposal.</td></tr>
<tr><td><code>proposalID</code></td><td><code>uint256</code></td><td>The ID of the proposal.</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../contracts/dao/Property.sol/contract.Property.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../contracts/dao/Subscription.sol/contract.Subscription.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../contracts/dao/Property.sol/contract.Property.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../contracts/dao/Subscription.sol/contract.Subscription.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../solidity.min.js"></script>


    </div>
    </body>
</html>
